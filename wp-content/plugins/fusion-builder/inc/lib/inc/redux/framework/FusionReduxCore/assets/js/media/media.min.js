!function(a){"use strict";fusionredux.field_objects=fusionredux.field_objects||{},fusionredux.field_objects.media=fusionredux.field_objects.media||{};var b;a(document).ready(function(){}),fusionredux.field_objects.media.init=function(c){c||(c=a(document).find(".fusionredux-group-tab:visible").find(".fusionredux-container-media:visible")),a(c).each(function(){var c=a(this),d=c;c.hasClass("fusionredux-field-container")||(d=c.parents(".fusionredux-field-container:first")),d.is(":hidden")||d.hasClass("fusionredux-field-init")&&(d.removeClass("fusionredux-field-init"),b=!1,c.find(".remove-image, .remove-file").unbind("click").on("click",function(){fusionredux.field_objects.media.removeFile(a(this).parents("fieldset.fusionredux-field:first"))}),c.find(".media_upload_button").unbind().on("click",function(b){fusionredux.field_objects.media.addFile(b,a(this).parents("fieldset.fusionredux-field:first"))}))})},fusionredux.field_objects.media.addFile=function(c,d){c.preventDefault();var e,f,g=a(this);if(e)return void e.open();var h=a(d).find(".library-filter").data("lib-filter");void 0!==h&&""!==h&&(f=[],b=!0,h=decodeURIComponent(h),h=JSON.parse(h),a.each(h,function(a,b){f.push(b)})),e=wp.media({multiple:!1,library:{type:f},title:g.data("choose"),button:{text:g.data("update")}}),e.on("select",function(){var c=e.state().get("selection").first();e.close();var f=a(d).find(".data").data();if(void 0!==fusionredux.field_objects.media&&void 0!==typeof fusionredux.field_objects.media||(fusionredux.field_objects.media={}),void 0!==f&&"undefined"!==f.mode||(f={},f.mode="image"),!0===b&&(f.mode=0),0===f.mode);else if(!1!==f.mode&&c.attributes.type!==f.mode&&c.attributes.subtype!==f.mode)return;d.find(".upload").val(c.attributes.url),d.find(".upload-id").val(c.attributes.id),d.find(".upload-height").val(c.attributes.height),d.find(".upload-width").val(c.attributes.width),fusionredux_change(a(d).find(".upload-id"));var g=c.attributes.url;if(void 0!==c.attributes.sizes&&void 0!==c.attributes.sizes.thumbnail)g=c.attributes.sizes.thumbnail.url;else if(void 0!==c.attributes.sizes){var h=c.attributes.height;for(var i in c.attributes.sizes){var j=c.attributes.sizes[i];j.height<h&&(h=j.height,g=j.url)}}else g=c.attributes.icon;d.find(".upload-thumbnail").val(g),d.find(".upload").hasClass("noPreview")||d.find(".screenshot").empty().hide().append('<img class="fusionredux-option-image" src="'+g+'">').slideDown("fast"),d.find(".remove-image").removeClass("hide"),d.find(".fusionredux-background-properties").slideDown()}),e.open()},fusionredux.field_objects.media.removeFile=function(b){if(b.find(".remove-image").addClass("hide")){b.find(".remove-image").addClass("hide"),b.find(".upload").val(""),b.find(".upload-id").val(""),b.find(".upload-height").val(""),b.find(".upload-width").val(""),b.find(".upload-thumbnail").val(""),fusionredux_change(a(b).find(".upload-id")),b.find(".fusionredux-background-properties").hide();b.find(".screenshot").slideUp(),b.find(".remove-file").unbind(),b.find(".section-upload .upload-notice").length>0&&b.find(".media_upload_button").remove()}}}(jQuery);