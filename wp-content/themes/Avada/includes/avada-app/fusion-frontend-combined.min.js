var FusionPageBuilder=FusionPageBuilder||{};!function(){FusionPageBuilder.Panel=Backbone.Model.extend({defaults:{type:"panel"}}),FusionPageBuilder.Tab=Backbone.Model.extend({defaults:{type:"tab"}}),FusionPageBuilder.SidebarView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-sidebar-template").html()),events:{"click .fusion-builder-toggles a":"switchContext","focus .fusion-builder-search":"initSearch","keypress .fusion-builder-search":"checkResults","click .fusion-builder-go-back":"switchInnerContext"},currentSectionTarget:!1,fbeOptionsAdded:!1,initialize:function(){this.toSearch=!1,this.poSearch=!1,this._showResults=_.debounce(_.bind(this.showResults,this),500),this.viewManager=jQuery.extend(!0,{},new FusionPageBuilder.ViewManager),this.panelData={open:!1,width:327,context:"to",dialog:!1},this.setPanelStates(),this.flatToObject=!1,this.flatPoObject=!1,this.searchContext="to",this.$body=jQuery("body"),this.$previewPanel=this.$body.find("#customize-preview"),this.listenTo(FusionEvents,"fusion-to-posts_slideshow_number-changed",this.recreatePoTab),this.listenTo(FusionEvents,"fusion-postMessage-custom_fonts",this.updateCustomFonts),this.listenTo(FusionEvents,"fusion-to-portfolio_equal_heights-changed",this.togglePortfolioEqualHeights),this.listenTo(FusionEvents,"fusion-app-setup",this.setup),this.listenTo(FusionEvents,"fusion-preferences-editing_mode-updated",this.setDialogMode),this.listenTo(FusionEvents,"fusion-preferences-sidebar_position-updated",this.setDialogMode),this.listenTo(FusionEvents,"fusion-preferences-sidebar_overlay-updated",this.setDialogMode)},render:function(){return this.$el.html(this.template(this.panelData)),this.addToPanels(),this.resizableDrag(),this.setPanelStyling(),this.setActiveTab(),this},setup:function(){this.addPoPanels(FusionApp.data.samePage),this.addFBEPanels(),this.setDialogMode(),this.setArchiveMode(),this.setPostTypeLabel(),!1===FusionApp.data.is_fusion_element&&void 0===FusionApp.data.template_category&&this.createEditShortcuts()},setDialogMode:function(){var a="undefined"!=typeof FusionApp&&void 0!==FusionApp.preferencesData&&FusionApp.preferencesData;a&&"dialog"===a.editing_mode?(this.$el.find("#customize-controls").attr("data-dialog",!0),this.updatePanelData("dialog",!0),"eo"===this.panelData.context&&this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-to"]').trigger("click")):(this.$el.find("#customize-controls").attr("data-dialog",!1),this.updatePanelData("dialog",!1)),a&&("right"!==a.sidebar_position||this.$body.hasClass("sidebar-right")?"left"===a.sidebar_position&&this.$body.hasClass("sidebar-right")&&(this.$body.removeClass("sidebar-right"),this.destroyResizable(),this.resizableDrag(),this.setPanelStyling()):(this.$body.addClass("sidebar-right"),this.destroyResizable(),this.resizableDrag(),this.setPanelStyling()),"on"===a.sidebar_overlay?this.$previewPanel.addClass("fusion-overlay-mode"):this.$previewPanel.removeClass("fusion-overlay-mode"))},setPostTypeLabel:function(){var a=this.$el.find(".label.fusion-po-only");"fusion_tb_section"===FusionApp.data.postDetails.post_type&&0<a.length?a.html(a.data("layout")):a.html(a.data("page"))},setArchiveMode:function(){"undefined"!=typeof FusionApp&&FusionApp.data.is_archive?this.$el.find("#customize-controls").attr("data-archive",!0):this.$el.find("#customize-controls").attr("data-archive",!1),"undefined"!=typeof FusionApp&&this.$el.find("#customize-controls").attr("data-editor",FusionApp.builderActive)},createEditShortcuts:function(){var a,b=this,c=b.getFlatToObject(),d=b.getFlatPoObject(),e=jQuery("#fb-preview").contents().find("html"),f=jQuery.extend(!0,b.createShortcutsObject(c),b.createShortcutsObject(d,"po"));_.each(f,function(b,c){a=e.find(c),a.length&&!a.hasClass("fusion-panel-customizable")&&(a.append('<span class="fusion-panel-shortcuts-wrapper"><span class="fusion-panel-shortcuts">'+b.join("")+"</span></span>"),a.addClass("fusion-panel-customizable"),"static"===a.css("position")&&a.addClass("fusion-panel-customizable-needs-positioned"))}),e.on("click",".fusion-panel-shortcut",function(a){var c=jQuery(this);void 0===c.attr("href")&&(a.preventDefault(),b.shortcutClick(c))})},createShortcutsObject:function(a,b){var c,d,e={};return b=void 0!==b?b:"",_.each(a,function(a){"object"==typeof a.edit_shortcut&&(c="string"==typeof a.edit_shortcut.selector?a.edit_shortcut.selector.split(","):a.edit_shortcut.selector,_.each(c,function(c){c=c.trim(),_.each(a.edit_shortcut.shortcuts,function(f){var g,h=f.aria_label||!1,i="",j="",k="",l="",m="",n=jQuery.extend(!0,{},f);if(h){if(void 0!==n&&""!==n.disable_on_template_override&&void 0!==FusionApp.data.template_override&&void 0!==FusionApp.data.template_override[n.disable_on_template_override]&&!1!==FusionApp.data.template_override[n.disable_on_template_override])return;void 0!==n&&""!==n.link_to_template_if_override_active&&void 0!==FusionApp.data.template_override&&void 0!==FusionApp.data.template_override[n.link_to_template_if_override_active]&&!1!==FusionApp.data.template_override[n.link_to_template_if_override_active]&&(FusionApp.data.template_override[n.link_to_template_if_override_active].permalink&&-1!==FusionApp.data.template_override[n.link_to_template_if_override_active].permalink.indexOf("?")?n.link=FusionApp.data.template_override[n.link_to_template_if_override_active].permalink+"&fb-edit=1&target_post_id="+FusionApp.data.postDetails.post_id:n.link=FusionApp.data.template_override[n.link_to_template_if_override_active].permalink+"?fb-edit=1&target_post_id="+FusionApp.data.postDetails.post_id,n.target="_top",n.aria_label=void 0!==fusionBuilderText["edit_"+n.link_to_template_if_override_active+"_layout_section"]?fusionBuilderText["edit_"+n.link_to_template_if_override_active+"_layout_section"]:fusionBuilderText.edit_layout_section,void 0!==n.override_icon&&(j=f.override_icon)),void 0!==n.link?(i=void 0!==n.target?n.target:"_blank",g=void 0!==n.css_class?n.css_class:"",""===j&&(j=void 0!==n.icon?n.icon:"fusiona-pen"),l='<a class="fusion-panel-shortcut '+g+'" href="'+n.link+'" target="'+i+'" aria-label="'+n.aria_label+'"><span class="'+j+'"></span></a>'):(""===j&&(j=void 0!==n.icon?n.icon:"fusiona-cog"),void 0!==n.open_parent&&(k=' data-fusion-option-open-parent="true"'),void 0!==n.callback&&(m=' data-callback="'+n.callback+'"'),d=void 0!==n.context?n.context:b,l='<span class="fusion-panel-shortcut" data-fusion-option="'+a.id+'" aria-label="'+n.aria_label+'" data-context="'+d+'"'+k+m+'><span class="'+j+'"></span></span>'),void 0===e[c]&&(e[c]=[]),void 0!==n.order?e[c][n.order]=l:e[c].push(l)}})}))}),e},shortcutClick:function(a){a.attr("data-callback")&&"function"==typeof FusionApp.callback[a.attr("data-callback")]?FusionApp.callback[a.attr("data-callback")](a):this.openOption(a.data("fusion-option"),a.data("context"),a.data("fusion-option-open-parent"))},openOption:function(a,b,c){var d,e,f,g=this;b=void 0!==b&&b?b:"to",d="po"!==b?this.getFlatToObject():this.getFlatPoObject(),e=d[a],f="object"==typeof e&&e.tab_id,c=void 0!==c&&c,!0===c&&(f=void 0!==e?e.parent_id:a),b=b.toLowerCase(),this.togglePanelState(b,!0),this.setActiveTab(b),e&&"FBE"===e.location&&this.switchActiveContext("#fusion-builder-sections-to","FBE"),this.$el.find("#tab-"+f).length&&this.$el.find("#tab-"+f).is(":visible")||(this.$el.find(".fusion-sidebar-section:visible #"+f).length?this.$el.find(".fusion-sidebar-section:visible #"+f).trigger("click"):this.$el.find(".fusion-sidebar-section:visible #heading_"+f).length&&(!0!==g.$el.find(".fusion-panels").is(":visible")&&(g.$el.find(".fusion-builder-custom-tab:visible .fusion-builder-go-back").trigger("click"),g.$el.find(".fusion-panels").show()),"true"!==this.$el.find(".fusion-sidebar-section:visible #heading_"+f).attr("aria-expanded")&&this.$el.find(".fusion-sidebar-section:visible #heading_"+f).trigger("click"))),setTimeout(function(){c?g.scrollToElement(g.$el.find(".fusion-sidebar-section:visible #heading_"+f)):g.scrollToElement(g.$el.find('[data-option-id="'+e.id+'"]:visible'))},50)},scrollToElement:function(a,b){var c=this.$el.find(".fusion-sidebar-section:visible .fusion-tabs"),d=this.$el.find(".fusion-builder-toggles").outerHeight()+this.$el.find(".fusion-panel-section-header-wrapper").outerHeight(),e=0;c.is(":visible")||(c=this.$el.find(".fusion-sidebar-section:visible .fusion-panels")),b=void 0===b||b,a.length&&(b?(e=a.position().top+c.scrollTop()-d,c.animate({scrollTop:e},450)):(e=a.position().top+c.scrollTop()-d,c.scrollTop(e)))},getFlatToObject:function(){var a={};return!1!==this.flatToObject?this.flatToObject:(_.each(customizer,function(b,c){_.each(b.fields,function(b,d){"sub-section"===b.type||"accordion"===b.type?_.each(b.fields,function(b,e){b.tab_id=d,b.location="TO",a[e]=b,b.parent_id=c}):(b.tab_id=c,b.location="TO",a[d]=b)})}),FusionApp.data&&FusionApp.data.fusionElementsOptions&&_.each(FusionApp.data.fusionElementsOptions,function(b,c){_.each(b.fields,function(b,d){"sub-section"===b.type||"accordion"===b.type?_.each(b.fields,function(b,c){b.tab_id=d,b.location="FBE",a[c]=b}):(b.tab_id=c,b.location="FBE",a[d]=b)})}),this.flatToObject=a,this.flatToObject)},getFlatPoObject:function(){var a={},b=jQuery.extend(!0,{},FusionApp.data.fusionPageOptions);return!1!==this.flatPoObject?this.flatPoObject:(_.each(b,function(b,c){_.each(b.fields,function(b,d){"sub-section"===b.type||"accordion"===b.type?_.each(b.fields,function(b,c){b.tab_id=d,b.location="po",a[c]=b}):(b.tab_id=c,b.location="po",a[d]=b)})}),this.flatPoObject=a,this.flatPoObject)},initSearch:function(){var a="TO",b={threshold:.3,minMatchCharLength:3,keys:["label"]};"po"===this.panelData.context&&(a="PO"),this.searchContext=a,"TO"===a?this.toSearch=new Fuse(_.values(this.getFlatToObject()),b):this.poSearch=new Fuse(_.values(this.getFlatPoObject()),b)},clearSearch:function(){this.$el.find(".fusion-builder-search").val("")},showToggles:function(){this.$el.find(".fusion-builder-toggles").show()},hideToggles:function(){this.$el.find(".fusion-builder-toggles").hide()},destroyResizable:function(){this.$el.find("#customize-controls").resizable("destroy")},resizableDrag:function(){var a=this,b=this.$el.find("#customize-controls"),c=this.$body.hasClass("sidebar-right")?"w":"e";b.hover(function(){a.$body.addClass("fusion-preview-block")},function(){a.$body.hasClass("fusion-sidebar-resizing")||a.$body.removeClass("fusion-preview-block")}),b.resizable({handles:c,minWidth:327,maxWidth:640,start:function(){a.$body.addClass("fusion-preview-block").addClass("fusion-sidebar-resizing")},resize:function(b,c){var d=327>=c.size.width?327:c.size.width;d=640<d?640:d,a.$body.hasClass("sidebar-right")?a.$previewPanel.css("padding-right",d).css("padding-left",0):a.$previewPanel.css("padding-left",d).css("padding-right",0)},stop:function(c,d){var e=327>=d.size.width?327:d.size.width;e=640<e?640:e,a.$body.hasClass("sidebar-right")&&b.css({left:"auto",right:0}),a.updatePanelData("width",e),a.$body.removeClass("fusion-preview-block").removeClass("fusion-sidebar-resizing")}})},checkResults:function(a){this._showResults(a)},showResults:function(a){var b,c,d=jQuery(a.currentTarget).val(),e=this.panelData.context,f="po"!==e?this.toSearch.search(d):this.poSearch.search(d),g=this.$el.find("#fusion-builder-sections-"+e),h={};_.each(f,function(a){h[a.id]=a}),b={model:new FusionPageBuilder.Tab({fields:h,id:"fusion-builder-results",type:"search",label:fusionBuilderText.search_results,context:this.searchContext})},c=new FusionPageBuilder.TabView(b),this.clearTabs(e),g.find("#tab-fusion-builder-results").remove(),g.find(".fusion-tabs").append(c.render().el).show(),g.find(".fusion-tabs").show(),g.find(".fusion-panels, .fusion-tabs .fusion-builder-custom-tab").hide(),g.find("#tab-fusion-builder-results").show()},addToPanels:function(){var a=this,b=this.$el.find("#fusion-builder-sections-to .fusion-panels");_.each(customizer,function(c){var d,e,f=a.viewManager.generateCid();c.label&&(c.cid=f,c.context="TO",c.innerContext="TO",d=new FusionPageBuilder.Panel(c),e=new FusionPageBuilder.PanelView({model:d}),a.viewManager.addView(f,e),b.append(e.render().el))})},addFBEPanels:function(){var a=this,b=this.$el.find("#fusion-builder-sections-to .fusion-panels");a.fbeOptionsAdded||(_.each(FusionApp.data.fusionElementsOptions,function(c){var d,e,f=a.viewManager.generateCid();c.label&&(c.cid=f,c.context="TO",c.innerContext=void 0!==c.addon&&c.addon?"FBAO":"FBE",d=new FusionPageBuilder.Panel(c),e=new FusionPageBuilder.PanelView({model:d}),a.viewManager.addView(f,e),b.append(e.render().el))}),a.fbeOptionsAdded=!0)},updateLabels:function(){this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-po-label').addClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-ps-label').addClass("hidden"),"archive"!==FusionApp.data.currentPage?(this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-page-options').removeClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-page-settings').removeClass("hidden")):(this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-taxonomy-options').removeClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-category-settings').removeClass("hidden"))},addPoPanels:function(a){var b=this.$el.find("#fusion-builder-sections-po .fusion-panels"),c=this;a&&b.find(".fusion-builder-custom-panel").length||(!a&&b.find(".fusion-builder-custom-panel").length&&(this.$el.find("#tab-fusion-builder-results").is(":visible")?this.$el.find("#tab-fusion-builder-results .fusion-builder-go-back").trigger("click"):(this.$el.find('#fusion-builder-tab .fusion-builder-custom-tab[data-type="PO"]').is(":visible")||this.$el.find('a[href="#fusion-builder-sections-po"].fusion-active').length)&&this.$el.find('a[href="#fusion-builder-sections-po"]').trigger("click"),this.clearPanels("po"),this.clearTabs("po")),_.each(FusionApp.data.fusionPageOptions,function(a){var d,e,f=c.viewManager.generateCid();a.label&&(a.cid=f,a.context="PO",d=new FusionPageBuilder.Panel(a),e=new FusionPageBuilder.PanelView({model:d}),b.append(e.render().el),c.viewManager.addView(f,e))}),jQuery('.fusion-builder-toggles [href="#fusion-builder-sections-po"]').hasClass("fusion-active")&&jQuery('.fusion-builder-toggles [href="#fusion-builder-sections-po"]').click())},clearPanels:function(a){var b,c,d=this;a=void 0===a?"to":a.toLowerCase(),b=this.$el.find("#fusion-builder-sections-"+a+" .fusion-builder-custom-panel"),b.length&&b.each(function(){(c=d.viewManager.getView(jQuery(this).data("cid")))&&c.removePanel()})},clearTabs:function(a,b,c){var d,e,f,g=this;a=void 0===a?"to":a.toLowerCase(),d=this.$el.find("#fusion-builder-sections-"+a),e=void 0!==b&&b?d.find(".fusion-builder-custom-tab#"+b):d.find(".fusion-builder-custom-tab"),void 0!==c&&c&&(e=e.find('.fusion-builder-option[data-option-id="'+c+'"]').closest(".fusion-builder-custom-tab")),e.length&&e.each(function(){(f=g.viewManager.getView(jQuery(this).data("cid")))&&f.removeTab()})},clearInactiveTabs:function(a){var b,c,d,e=this;a=void 0===a?"to":a.toLowerCase(),b=this.$el.find("#fusion-builder-sections-"+a),c=b.find(".fusion-builder-custom-tab:not( :visible )"),c.length&&c.each(function(){(d=e.viewManager.getView(jQuery(this).data("cid")))&&d.removeTab()})},recreatePanels:function(){this.clearPanels("po"),this.addPoPanels(!0)},refreshTo:function(){var a=this;this.$el.find("#fusion-builder-sections-to").show(),this.$el.find('#fusion-builder-tab .fusion-builder-custom-tab[data-type="TO"]').each(function(){a.viewManager.removeView(jQuery(this).data("cid")),jQuery(this).remove()})},switchContext:function(a){var b=jQuery(a.currentTarget),c=b.attr("href"),d=this.$el.find(c),e=c.replace("#fusion-builder-sections-","");a.preventDefault(),this.$el.find(".fusion-active").removeClass("fusion-active"),this.$el.find(".fusion-sidebar-section").hide(),d.show(),d.is("#fusion-builder-sections-eo")||!d.find(".fusion-tabs").is(":visible")||d.find(".fusion-tabs").find(".fusion-builder-custom-tab:visible").length||d.find(".fusion-panels").is(":visible")||(d.find(".fusion-tabs").hide(),d.find(".fusion-panels").show()),b.addClass("fusion-active"),this.setPanelContext(e)},closeSidebar:function(){this.updatePanelData("open",!1),this.setPanelStyling()},openSidebar:function(){this.updatePanelData("open",!0),this.setPanelStyling()},getPanelWidth:function(){return this.panelData.width},panelIsOpen:function(){return this.panelData.open},togglePanel:function(){this.panelIsOpen()?this.closeSidebar():this.openSidebar()},setPanelContext:function(a){this.$el.find("#customize-controls").attr("data-context",a),this.updatePanelData("context",a)},togglePanelState:function(a,b){var c=void 0===a?"to":a,d=this.panelData.context,e=this.panelIsOpen()&&void 0!==d&&d&&c!==d;if(b=void 0!==b,e)return void this.setActiveTab(c);b&&this.panelIsOpen()||(this.togglePanel(),this.setPanelStyling(),this.panelIsOpen()&&this.setActiveTab(c))},setPanelStyling:function(){var a=this.getPanelWidth(),b=this.$body.hasClass("sidebar-right")?"right":"left",c=this.$body.hasClass("sidebar-right")?"left":"right",d={width:a};d[b]=0,d[c]="auto",this.panelIsOpen()?(this.$body.addClass("expanded"),this.$previewPanel.css("padding-"+b,a).css("padding-"+c,0),this.$el.find("#customize-controls").css(d)):(this.$body.removeClass("expanded"),this.$previewPanel.css("padding-"+b,0).css("padding-"+c,0),this.$el.find("#customize-controls").css(b,-a).css(c,"auto").css("width",a)),FusionEvents.trigger("fusion-sidebar-toggled",this.panelIsOpen())},setActiveTab:function(a){var b=this.$el,c=void 0!==a&&a;a=void 0===a?this.panelData.context:a.toLowerCase(),c&&this.setPanelContext(a),b.find('.fusion-builder-toggles a[href="#fusion-builder-sections-'+a+'"]').hasClass("fusion-active")||(b.find(".fusion-builder-toggles > .fusion-active").removeClass("fusion-active"),b.find('.fusion-builder-toggles a[href="#fusion-builder-sections-'+a+'"]').trigger("click"))},updatePanelData:function(a,b){this.panelData[a]=b,this.storePanelStates(),"open"!==a&&"width"!==a||setTimeout(function(){FusionEvents.trigger("fusion-frame-size-changed")},500)},setPanelStates:function(){var a;if("undefined"!=typeof Storage&&localStorage.getItem("fusionPanel"))try{a=JSON.parse(localStorage.getItem("fusionPanel")),"object"==typeof a&&(this.panelData={open:void 0!==a.open&&a.open,width:void 0!==a.width?a.width:327,context:void 0!==a.context?a.context:"to",dialog:void 0!==a.dialog&&a.dialog})}catch(a){}},storePanelStates:function(){"undefined"!=typeof Storage&&localStorage.setItem("fusionPanel",JSON.stringify(this.panelData))},fixToValueName:function(a,b,c){var d=this.getFlatToObject();if(void 0!==d[a]&&void 0!==d[a].choices&&void 0!==d[a].choices[b]&&"yesno"!==c)return d[a].choices[b];switch("object"==typeof b&&(b=_.values(b).join(", ")),c){case"yesno":1==b?b="Yes":0==b&&(b="No");break;case"showhide":1==b?b="Show":0==b&&(b="Hide");break;case"reverseyesno":b=1==b||1==b?"No":"Yes"}return b},recreatePoTab:function(){var a,b,c,d=fusionSanitize.getOption("posts_slideshow_number"),e=this,f={};if(!1!==FusionApp.data.is_singular&&("post"===FusionApp.data.postDetails.post_type||"page"===FusionApp.data.postDetails.post_type||"avada_portfolio"===FusionApp.data.postDetails.post_type)){for(b=FusionApp.data.postDetails.post_type,jQuery.each(FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields,function(a){-1!==a.indexOf("kd_featured-image-")&&delete FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields[a]}),c=2;c<=d;c++)a="kd_featured-image-"+c+"_"+b+"_id",f=jQuery.extend(!0,{},FusionApp.data.featured_image_default),f.id=a,f.label=f.label.replace("$",c),f.partial_refresh[a]=jQuery.extend(!0,{},f.partial_refresh["kd_featured-image-$_#_id"]),delete f.partial_refresh["kd_featured-image-$_#_id"],FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields[a]=jQuery.extend({},f);e.viewManager.removeView(this.$el.find("#tab-fusion_page_settings_section").data("cid")),this.$el.find("#tab-fusion_page_settings_section").remove()}},updateCustomFonts:function(){var a=this,b={action:"avada_custom_fonts_font_faces",fusion_load_nonce:fusionAppConfig.fusion_load_nonce,custom_fonts:FusionApp.settings.custom_fonts};return FusionApp.assets.webfonts?(FusionApp.assets.webfonts.custom=[],_.each(FusionApp.settings.custom_fonts.name,function(a){FusionApp.assets.webfonts.custom.push({family:a,label:a,subsets:[],variants:[]})}),jQuery.post(fusionAppConfig.ajaxurl,b,function(a){jQuery("#fb-preview").contents().find("head").find("#css-custom_fonts").length&&jQuery("#fb-preview").contents().find("head").find("#css-custom_fonts").remove(),jQuery("#fb-preview").contents().find("head").append('<style type="text/css" id="css-custom_fonts">'+a+"</style>")}),this.clearPanels("po"),this):(jQuery.when(FusionApp.assets.getWebFonts()).done(function(){a.updateCustomFonts()}),this)},togglePortfolioEqualHeights:function(){"1"===fusionSanitize.getOption("portfolio_equal_heights")?jQuery("#fb-preview").contents().find(".fusion-portfolio-archive").addClass("fusion-portfolio-equal-heights"):jQuery("#fb-preview").contents().find(".fusion-portfolio-archive").removeClass("fusion-portfolio-equal-heights"),window.frames[0].dispatchEvent(new Event("fusion-element-render-fusion_portfolio"))},switchInnerContext:function(a){var b=jQuery(a.currentTarget),c=b.data("context"),d=b.data("trigger"),e=this.$el.find("a#"+d).closest(".fusion-builder-custom-panel");b.closest(".fusion-sidebar-section").attr("data-context",c),this.scrollToElement(e,!1)},switchActiveContext:function(a,b){this.$el.find(a).attr("data-context",b).scrollTop(0)},renderElementSettings:function(a){this.openSidebarAndShowEOTab(),this.$el.find("#fusion-builder-sections-eo").append(a.render().el),FusionPageBuilderApp.SettingsHelpers.renderDialogMoreOptions(a)},openSidebarAndShowEOTab:function(){var a=this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-eo"]');a.hasClass("fusion-active")||a.trigger("click"),this.panelIsOpen()||this.openSidebar(),this.$el.find("#fusion-builder-sections-eo").scrollTop(0)}})}(jQuery);var FusionPageBuilder=FusionPageBuilder||{};!function(){FusionPageBuilder.PanelView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-panel-template").html()),className:"fusion-builder-custom-panel",events:{"click .fusion-panel-link":"showTabs","click .fusion-sub-section-link":"showTabs"},initialize:function(){this.$el.attr("data-id",this.model.get("id")),this.$el.attr("data-cid",this.model.get("cid")),this.$el.attr("data-context",this.model.get("innerContext"))},render:function(){return this.setIcon(),this.$el.html(this.template(this.model.attributes)),this},setIcon:function(){var a=this.model.get("icon");void 0!==this.model.get("alt_icon")&&(a=this.model.get("alt_icon")),void 0!==a&&-1===a.indexOf("fusiona")?delete this.model.attributes.icon:this.model.set("icon",a)},removePanel:function(){FusionApp.sidebarView.viewManager.removeView(this.model.get("cid")),this.remove()},showTabs:function(a){var b,c,d,e,f,g,h=jQuery(a.currentTarget),i=h.closest(".fusion-sidebar-section"),j=FusionApp.sidebarView.viewManager.generateCid(),k=this.model.get("fields"),l=!1;if(a.preventDefault(),FusionApp.data.postMeta._fusion=FusionApp.data.postMeta._fusion||{},h.parent().find("li").length)"true"===h.parent().find("a.fusion-panel-link").attr("aria-expanded")&&(l=!0),i.find(".fusion-builder-custom-panel ul li").hide(),i.find(".fusion-builder-custom-panel ul a.fusion-panel-link").attr("aria-expanded","false"),l?(h.parent().find("li").hide(),h.parent().find("a.fusion-panel-link").attr("aria-expanded","false")):(h.parent().find("li").show(),h.parent().find("a.fusion-panel-link").attr("aria-expanded","true"));else{if(setTimeout(function(){g=i.find(".fusion-panels").filter(":visible"),0===g.length&&(g=i.find(".fusion-tabs").filter(":visible")),g.scrollTop(0)},50),h.hasClass("fusion-sub-section-link")?(d=h.attr("id"),b=k[d].fields):(d=this.model.get("id"),b=k),"shortcode_styling"===d||"fusion_builder_elements"===d)return void FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBE");if("fusion_builder_addons"===d)return void FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBAO");i.find(".fusion-builder-custom-tab#tab-"+d).length?(f=FusionApp.sidebarView.viewManager.getView(i.find(".fusion-builder-custom-tab#tab-"+d).data("cid")),void 0!==f&&f.initialCheckDependencies(),f.showTab()):(c={model:new FusionPageBuilder.Tab({fields:b,id:d,type:void 0!==this.model.get("innerContext")?this.model.get("innerContext").toUpperCase():this.model.get("context").toUpperCase(),cid:j,label:jQuery(a.currentTarget).data("label")})},e=new FusionPageBuilder.TabView(c),FusionApp.sidebarView.viewManager.addView(j,e),i.find(".fusion-tabs").append(e.render().el)),i.find(".fusion-tabs").show(),i.find(".fusion-panels").hide(),i.find(".fusion-builder-custom-tab:not( #tab-"+d+")").hide()}}})}(jQuery),function(){window.avadaPanelIFrame={fields:{},fieldOutputDependencies:{},applyCallback:function(a,b,c){return c=c||!1,_.isFunction(FusionApp.callback[b])?FusionApp.callback[b](a,c):_.isFunction(window[b])?window[b](a,c):_.isFunction(fusionSanitize[b])?fusionSanitize[b](a,c):_.isFunction(FusionPageBuilder.Callback.prototype[b])?FusionPageBuilder.Callback.prototype[b](a,c):a},applyRefreshCallbacks:function(a,b){var c=this,d=!0,e=c.getValueClone(b);return void 0!==a&&_.each(a,function(a){if(void 0===a.js_callback)return!1;a.js_callback[1]=_.isUndefined(a.js_callback[1])?"":a.js_callback[1],c.applyCallback(e,a.js_callback[0],a.js_callback[1])||(d=!1)}),d},partialRefresh:function(a,b,c,d){var e,f=FusionApp.getAjaxData("fusion_app_partial_refresh");_.each(b,function(a,c){var d=!1;a.skip_for_template&&(_.each(a.skip_for_template,function(a){FusionApp.data.template_override[a]&&(d=!0)}),d&&delete b[c])}),_.isEmpty(b)||(void 0!==b&&(_.each(b,function(a){e=jQuery("#fb-preview").contents().find("body").find(a.selector),e.length?e.append('<div id="fusion-loader"><span class="fusion-slider-loading"></span></div>'):(e=jQuery("#fb-preview").contents().find("head").find(a.selector),e.length&&jQuery("body").append('<div id="fusion-loader"><span class="fusion-slider-loading"></span></div>'))}),jQuery('li[data-option-id="'+a+'"]').addClass("partial-refresh-active")),f.partials=b,jQuery.ajax({type:"POST",url:fusionAppConfig.ajaxurl,dataType:"json",data:f,success:function(c){_.each(c,function(c,f){var g=(b[f].aria_label,"string"==typeof b[f].success_trigger_event?b[f].success_trigger_event.split(" "):b[f].success_trigger_event);c=FusionApp.removeScripts(c,d),e=jQuery("#fb-preview").contents().find("html").find(b[f].selector),void 0!==c?(c.length||(c=""),b[f].after?e.after(c):b[f].container_inclusive?e.replaceWith(c):e.html(c),jQuery("#fusion-loader").remove()):(e.html(""),jQuery("#fusion-loader").remove()),jQuery('li[data-option-id="'+a+'"]').removeClass("partial-refresh-active"),b[f].success_trigger_event&&_.each(g,function(a){window.dispatchEvent(new Event(a)),window.frames[0].window.dispatchEvent(new Event(a)),"function"==typeof window[a]&&window[a](),"function"==typeof window.frames[0].window[a]&&window.frames[0].window[a]()}),e.removeClass("fusion-panel-customizable"),FusionApp.sidebarView.createEditShortcuts()}),FusionApp.injectScripts(d),setTimeout(function(){jQuery("#fb-preview")[0].contentWindow.jQuery("body").trigger("fusion-partial-"+a)},100)}}))},getValueClone:function(a){return a},getPoToValue:function(a,b){var c=this.getGlobalMapKey(a);return c?this.getPoToValueFromGlobalKey(c,b):null},getGlobalMapKey:function(a){var b=a;return _.each(["is_home","is_tag","is_category","is_author","is_date","is_singular_post"],function(c){if(FusionApp.data[c]&&_.find(fusionOptionNetworkNames,function(d,e){if(d[c]&&a===d[c])return b=e,!0}),b)return!0}),b},getPoToValueFromGlobalKey:function(a,b){var c,d=null,e=!1;switch(FusionApp.settings[a]&&(d=FusionApp.settings[a]),-1!==a.indexOf("[")&&(c=a.split("["),c[0]=c[0].replace("]",""),c[1]=c[1].replace("]",""),FusionApp.settings[c[0]]&&void 0!==FusionApp.settings[c[0]][c[1]]&&(d=FusionApp.settings[c[0]][c[1]])),fusionOptionNetworkNames[a]&&-1!==FusionApp.data.postDetails.post_id.toString().indexOf("-archive")&&fusionOptionNetworkNames[a].archive&&("object"==typeof fusionOptionNetworkNames[a].archive&&fusionOptionNetworkNames[a].archive[0]?FusionApp.settings[fusionOptionNetworkNames[a].archive[0]]&&(d=FusionApp.settings[fusionOptionNetworkNames[a].archive[0]],b&&"undefined"!==d[b]&&(d=d[b])):FusionApp.settings[fusionOptionNetworkNames[a].archive]&&(d=FusionApp.settings[fusionOptionNetworkNames[a].archive],b&&"undefined"!==d[b]&&(d=d[b]))),a){case"header_bg_repeat":case"header_bg_full":e=FusionApp.data.postMeta._fusion.header_bg_image&&""===FusionApp.data.postMeta._fusion.header_bg_image.url;break;case"bg_repeat":case"bg_full":e=FusionApp.data.postMeta._fusion.bg_image&&""===FusionApp.data.postMeta._fusion.bg_image.url;break;case"content_bg_repeat":case"content_bg_full":e=FusionApp.data.postMeta._fusion.content_bg_image&&""===FusionApp.data.postMeta._fusion.content_bg_image.url}return e||(void 0!==FusionApp.data.postMeta._fusion&&void 0!==FusionApp.data.postMeta._fusion[a]&&""!==FusionApp.data.postMeta._fusion[a]&&"default"!==FusionApp.data.postMeta._fusion[a]?d=FusionApp.data.postMeta._fusion[a]:void 0!==FusionApp.data.postMeta[a]&&""!==FusionApp.data.postMeta[a]&&"default"!==FusionApp.data.postMeta[a]&&(d=FusionApp.data.postMeta[a])),"page_title_bar"!==a&&"blog_show_page_title_bar"!==a&&"blog_page_title_bar"!==a||(d=d.toLowerCase(),d="yes"===d?"bar_and_content":d,d="yes_without_bar"===d?"content_only":d,d="no"===d?"hide":d),d},addHoverElements:function(a){var b="";return"string"==typeof a&&a.indexOf(",")&&(a=a.split(",")),"string"==typeof a&&-1!==a.indexOf(":hover")?(b=a.replace(":hover",".hover")+",")+a:("object"==typeof a&&(a=_.toArray(a),_.each(a,function(c){-1!==c.indexOf(":hover")&&(b=c.replace(":hover",".hover"),a.push(b))})),a)},generateCSS:function(a,b,c,d,e,f){var g,h,i,j,k,l,m="TO"===d||"FBE"===d?FusionApp.settings:FusionApp.data.postMeta._fusion,n=this;m=m||{},m="PS"===d?FusionApp.data.postDetails:m,g=m[a],h=g,i=h,d="FBE"===d?"TO":d,n.needsPreviewUpdate(a,d)&&(j='<style type="text/css" id="css-'+a+'">',b&&_.each(b,function(b){if("PS"!==d&&(h=n.getPoToValue(a,b.choice)),b=_.defaults(b,{element:"",property:"",units:"",prefix:"",suffix:"",js_callback:!1,callback:!1,value_pattern:"$",pattern_replace:!1,media_query:!1,function:"style"}),b=jQuery.extend(!0,{},b),!_.isObject(i)||_.isUndefined(b.choice)||_.isUndefined(i[b.choice])||(h=i[b.choice]),"PO"!==d||_.isObject(i)||_.isUndefined(b.choice)||(h=m[b.choice]),e&&(b.element=n.addHoverElements(b.element)),_.isObject(b.element)&&(b.element=jQuery.map(b.element,function(a){return[a]}),b.element=b.element.join(",")),"attr"===b.function)n.elementAttrs(b,h);else if("html"===b.function)n.elementHtmlContent(b,h);else{if(FusionApp.sidebarView.flatToObject[a]&&FusionApp.sidebarView.flatToObject[a].type)switch(FusionApp.sidebarView.flatToObject[a].type){case"media":h=h&&h.url?h.url:"",b.property&&"background-image"===b.property&&""===h&&(h="none")}_.isObject(h)?(k=jQuery.extend(!0,{},b),_.each(h,function(a,c){!b.element||"margin"!==b.property&&"padding"!==b.property||"top"!==c&&"bottom"!==c&&"left"!==c&&"right"!==c?b.property&&""!==b.property||(k.property=c):k.property=b.property+"-"+c,j+=n.getSingleCSS(a,k)})):j+=n.getSingleCSS(h,b)}}),c&&_.each(c,function(b){var c=n.getPoToValue(a,b.choice),d=":root";!_.isObject(c)||_.isUndefined(b.choice)||_.isUndefined(c[b.choice])||(c=c[b.choice]),b.value_pattern=void 0===b.value_pattern?"$":b.value_pattern,c=c||"",b.choice&&c&&"object"==typeof c[b.choice]&&(c=c[b.choice]),b.exclude&&("string"==typeof b.exclude&&(b.exclude=[b.exclude]),_.each(b.exclude,function(a){c===a&&(c="")})),
c=b.value_pattern.replace(/\$/g,c),void 0!==b.callback&&(c=n.applyCallback(c,b.callback[0],b.callback[1])),"string"==typeof b.element&&(d=b.element),j+=d+"{"+b.name+":"+c+";}"}),j+="</style>",jQuery("#fb-preview").contents().find("head").find("#css-"+a).length&&jQuery("#fb-preview").contents().find("head").find("#css-"+a).remove(),jQuery("#fb-preview").contents().find("head").append(j),l=["h1_typography","h2_typography","h3_typography","h4_typography","h5_typography","h6_typography"],_.contains(l,a)&&this.updateResponsiveTypography(a,g),"TO"===d||"FBE"===d?FusionApp.storedToCSS[a]=j:FusionApp.storedPoCSS[a]=j)},elementHtmlContent:function(a,b){var c,d=this;!0!==d.getExcludeBool(b,a)&&(b=d.getCssValue(b,a),c=jQuery("#fb-preview").contents().find(a.element),c.html(b))},elementAttrs:function(a,b){var c,d,e=this,f=e.getExcludeBool(b,a);if(!_.isUndefined(a.attr)&&!_.isEmpty(a.attr)&&!0!==f&&(b=e.getCssValue(b,a),a.toLowerCase&&(b=b.toLowerCase()),""!==b)){if(d=jQuery("#fb-preview").contents().find(a.element),c=d.attr(a.attr),_.isUndefined(c)&&(c=""),!_.isUndefined(a.remove_attrs)&&!_.isEmpty(a.remove_attrs)&&""!==c)return _.each(a.remove_attrs,function(b){"class"===a.attr&&d.removeClass(b),c=c.split(b+",").join(""),c=c.split(b+" ").join(""),c=c.split(b).join("")}),c+=""!==c?" ":"",c+=b,void("class"===a.attr?d.addClass(c):d.attr(a.attr,c));d.attr(a.attr,b)}},liveUpdateCustomCSS:function(a){var b=void 0!==a?a:"";jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").length&&jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").html(b)},liveUpdatePageCustomCSS:function(a){jQuery("#fb-preview").contents().find("#fusion-builder-page-css").length?jQuery("#fb-preview").contents().find("#fusion-builder-page-css").html(a):(a='<style type="text/css" id="fusion-builder-page-css">'+a+"</style>",jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").length?jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").after(a):jQuery("#fb-preview").contents().find("head").append(a))},updateResponsiveTypography:function(a,b){var c=a.split("_")[0];"function"==typeof jQuery("#fb-preview")[0].contentWindow.fusionCalculateResponsiveTypeValues&&document.querySelector("#fb-preview").contentWindow.document.body.dispatchEvent(new CustomEvent("fusion-typography",{detail:{heading:c,values:b}}))},getSingleCSS:function(a,b){var c=this,d=c.getExcludeBool(a,b),e="";return!0===d?"":(a=c.getCssValue(a,b),a=b.prefix+a+b.units+b.suffix,b.media_query&&(0===b.media_query.indexOf("fusion-")&&(b.media_query=fusionReturnMediaQuery(b.media_query)),e+=b.media_query+"{"),e+=b.element+"{"+b.property+":"+a+";}",b.media_query&&(e+="}"),!a||_.isEmpty(a)?"":e)},getExcludeBool:function(a,b){var c=!1;return _.isUndefined(b.exclude)||(a===b.exclude&&(c=!0),_.isArray(b.exclude)&&_.each(b.exclude,function(b){b==a&&(c=!0),!c&&_.isEmpty(b)&&_.isEmpty(a)&&(c=!0),c||_.isUndefined(a.url)||b!==a.url||(c=!0)})),c},getCssValue:function(a,b){var c=this;return void 0!==b.value_pattern&&!1!==b.value_pattern&&(a=b.value_pattern.replace(/\$/g,a),b.pattern_replace&&_.each(b.pattern_replace,function(b,c){var d=b.replace(originalOptionName+"[","").replace("]",""),e=b;d!==b&&(e=FusionApp.settings[d]),a=a.replace(c,e).replace(c,e)})),b.js_callback?(b.js_callback[1]=_.isUndefined(b.js_callback[1])?"":b.js_callback[1],a=c.applyCallback(a,b.js_callback[0],b.js_callback[1])):b.callback&&(b.callback[1]=_.isUndefined(b.callback[1])?"":b.callback[1],a=c.applyCallback(a,b.callback[0],b.callback[1])),b.property&&"background-image"===b.property&&"string"==typeof a&&-1===a.indexOf("url(")&&-1!==a.indexOf("/")&&-1!==a.indexOf(".")&&-1===a.indexOf("-gradient(")&&(a="url("+a+")"),a},needsPreviewUpdate:function(a,b){return"scheme_type"===a||"post_title"===a||"name"===a||("TO"!==b||this.validateChangeContext(a,b)[1]===b)},validateChangeContext:function(a,b){var c=a,d=!1,e={TAXO:"term",PO:"post",TO:"theme"};return b=void 0===e[b]?"TO":b,_.each(fusionOptionNetworkNames,function(f,g){!1===d&&(g===a||void 0!==f[e[b]]&&f[e[b]]===a)&&FusionApp.data.postMeta._fusion[c]&&""!==FusionApp.data.postMeta._fusion[c]&&"default"!==FusionApp.data.postMeta._fusion[c]&&(d=[c,b])}),!1===d?[c,"TO"]:d},populateFieldOutputDependencies:function(){var a,b=this;b.fieldOutputDependencies&&_.isEmpty(b.fieldOutputDependencies)&&(FusionApp.sidebarView.flatToObject&&!_.isEmpty(FusionApp.sidebarView.flatToObject)||FusionApp.sidebarView.getFlatToObject(),_.each(FusionApp.sidebarView.flatToObject,function(c){c.output&&_.each(c.output,function(d){d.js_callback&&d.js_callback&&d.js_callback[0]&&"conditional_return_value"===d.js_callback[0]&&_.each(d.js_callback[1].conditions,function(d){-1!==d[0].indexOf(originalOptionName+"[")&&(a=d[0].replace(originalOptionName+"[","").replace("]",""),b.fieldOutputDependencies[a]||(b.fieldOutputDependencies[a]=[]),-1===b.fieldOutputDependencies[a].indexOf(c.id)&&b.fieldOutputDependencies[a].push(c.id))}),d.pattern_replace&&_.each(d.pattern_replace,function(a,d){var e=a.replace(originalOptionName+"[","").replace("]","");b.fieldOutputDependencies[e]||(b.fieldOutputDependencies[e]=[]),-1===b.fieldOutputDependencies[e].indexOf(c.id)&&b.fieldOutputDependencies[e].push(c.id)})})}))}}}(jQuery);var FusionPageBuilder=FusionPageBuilder||{};!function(){FusionPageBuilder.TabView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-tab-template").html()),events:{"click .fusion-builder-go-back":"showSections","change input":"optionChange","keyup input:not(.fusion-slider-input)":"optionChange","change select":"optionChange","keyup textarea":"optionChange","change textarea":"optionChange","click .upload-image-remove":"removeImage","click .option-preview-toggle":"previewToggle","click .fusion-panel-description":"showHideDescription","click .fusion-panel-shortcut":"defaultPreview"},className:"fusion-builder-custom-tab",initialize:function(){this.$el.attr("id","tab-"+this.model.get("id")),this.$el.attr("data-cid",this.model.get("cid")),this.$el.attr("data-type",this.model.get("type")),this._updatePreview=_.debounce(_.bind(this.updatePreview,this),1e3),this._validateOption=_.debounce(_.bind(this.validateOption,this),1e3),this.options=this.model.get("fields"),this.type=this.model.get("type"),this.initialCheckDependencies(),this.activeStates={},this.$targetEl=!1,this._tempStateRemove=_.debounce(_.bind(this.tempStateRemove,this),3e3),this.hasSlug=!0,"import_export"===this.model.get("id")&&this.listenTo(FusionEvents,"fusion-to-changed",this.updateExportCode),"import_export_po"===this.model.get("id")&&(this.listenTo(FusionEvents,"fusion-po-changed",this.updateExportCode),this.listenTo(FusionEvents,"fusion-ps-changed",this.updateExportCode))},render:function(){return this.$el.html(this.template(this.model.attributes)),this.initOptions(),FusionApp.sidebarView.$el.find(".fusion-sidebar-section:visible").scrollTop(0),this},showTab:function(){this.$el.show(),FusionApp.sidebarView.$el.find(".fusion-sidebar-section:visible").scrollTop(0)},initialCheckDependencies:function(){var a=this;setTimeout(function(){"TO"!==a.type&&"PO"!==a.type&&"FBE"!==a.type||(a.dependencies=new FusionPageBuilder.Dependencies(a.options,a))},10)},optionChange:function(a){this.validateOption(a)&&(this.needsDebounce(a)?this._updatePreview(a):this.updatePreview(a))},removeTab:function(){FusionApp.sidebarView.viewManager.removeView(this.model.get("cid")),this.remove()},showHideDescription:function(a){var b=jQuery(a.currentTarget),c=b.closest(".fusion-builder-option").find(".fusion-tooltip-description"),d=c.text();b.closest(".fusion-builder-option").find(".description").first().slideToggle(250),c.text(d===fusionBuilderText.fusion_panel_desciption_show?fusionBuilderText.fusion_panel_desciption_hide:fusionBuilderText.fusion_panel_desciption_show),b.toggleClass("active")},defaultPreview:function(a){var b=jQuery(a.currentTarget);a&&a.preventDefault(),FusionApp.sidebarView&&(jQuery(".fusion-builder-toggles a").first().trigger("click"),FusionApp.sidebarView.openOption(b.data("fusion-option")))},initOptions:function(a){var b=void 0!==a&&a.length?a:this.$el;this.optionColorpicker(b),this.optionRadioButtonSet(b),this.optionDimension(b),this.optionSelect(b),this.optionAjaxSelect(b),this.optionMultiSelect(),this.optionRange(b),this.optionUpload(b),this.optionMultiUpload(b),this.optionCodeBlock(b),this.optionTypography(b),this.optionSwitch(b),this.optionImport(b),this.optionExport(b),this.optionSortable(b),this.optionColorPalette(b),this.optionRaw(b),this.optionLinkSelector(b),void 0===a&&this.optionRepeater(this.type)},needsDebounce:function(a){var b=jQuery(a.currentTarget).closest(".fusion-builder-option"),c=b.data("option-id"),d=this.model.get("fields"),e=d[c];return void 0===e&&b.parent().hasClass("repeater-fields")&&(c=b.parent().closest(".fusion-builder-option").data("option-id"),e=d[c]),(void 0===e||void 0===e.output&&void 0===e.css_vars&&(void 0===e.transport||"postMessage"!==e.transport))&&(void 0===e||"select"!==e.type)},showSections:function(a){var b,c=this.$el.closest(".fusion-sidebar-section");a&&a.preventDefault(),"search"===this.model.get("type")?(b=this.model.get("context"),"PO"===b||"PS"===b?(FusionApp.sidebarView.setActiveTab("po",b),jQuery("#fusion-builder-sections-po .fusion-panels").show()):(FusionApp.sidebarView.setActiveTab("to",b),jQuery("#fusion-builder-sections-to .fusion-panels").show()),FusionApp.sidebarView.clearSearch()):"TO"===this.model.get("type")?jQuery("#fusion-builder-sections-to .fusion-panels").show():"FBE"===this.model.get("type")?(FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBE"),c.find(".fusion-tabs").hide(),c.find(".fusion-panels").show()):"FBAO"===this.model.get("type")?(FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBAO"),c.find(".fusion-tabs").hide(),c.find(".fusion-panels").show()):jQuery("#fusion-builder-sections-po .fusion-panels").show(),this.$el.closest(".fusion-tabs").hide(),"fusion-builder-results"===this.model.get("id")?this.remove():FusionApp.sidebarView.scrollToElement(FusionApp.sidebarView.$el.find("a#"+this.model.get("id")).closest(".fusion-builder-custom-panel"),!1)},getValue:function(a,b,c){var d;return"checkbox"===a.attr("type")&&a.hasClass("fusion-select-option")?(c=[],_.each(a.parent().find(".fusion-select-option:checked"),function(a){c.push(jQuery(a).val())}),c):"checkbox"===a.attr("type")?a.is(":checked")?"1":"0":(a.hasClass("fusion-url-only-input")&&(d=a.closest(".fusion-upload-area").find(".fusion-image-as-object"),d.length&&d.val(JSON.stringify({url:c})).trigger("change")),jQuery(b.currentTarget).parents(".fusion-builder-option.code").length?this.codeEditorOption[jQuery(b.currentTarget).parents(".fusion-builder-option.code").attr("data-index")].getValue():(a.hasClass("fusion-with-default")&&(c=a.parents(".fusion-builder-option").find(".fusion-hidden-value").val(),c=c||""),a.hasClass("fusion-repeater-value")&&""!==c&&(c=JSON.parse(c)),c))},needsUpdate:function(a,b,c,d){return b!==d[c]&&(!a.hasClass("fusion-dont-update")&&!a.hasClass("fusion-import-file-input")&&"demo_import"!==c&&(a.parents(".fusion-builder-option.repeater").length&&!a.hasClass("fusion-repeater-value")?(a.hasClass("fusion-image-as-object")&&(b=void 0===b||""===b?{url:""}:jQuery.parseJSON(b)),this.setRepeaterValue(a.parents(".fusion-builder-option.repeater").find(".fusion-repeater-value"),c,a.parents(".repeater-row").index(),b),!1):(""!==b||!_.isUndefined(d[c])||!_.isUndefined(d[c]))&&(!(a&&a.hasClass("color-picker")&&!a.hasClass("fusion-color-created")||a.hasClass("fusion-color-palette-color-picker"))&&(!_.isObject(d[c])||!a.parents(".fusion-builder-dimension").length&&!a.parents(".fusion-builder-typography").length||b!==d[c][a.attr("name")]))))},saveChange:function(a,b,c,d,e){var f;if((_.isObject(d[c])||_.isUndefined(d[c]))&&(a.parents(".fusion-builder-dimension").length||a.parents(".fusion-builder-typography").length||a.parents(".fusion-builder-repeater").length))if(_.isUndefined(d[c])&&(d[c]={}),"variant"===a.attr("name")){if(d[c]["font-weight"]===this.getFontWeightFromVariant(b)&&d[c]["font-style"]===this.getFontStyleFromVariant(b))return;d[c].variant=b,d[c]["font-weight"]=this.getFontWeightFromVariant(b),d[c]["font-style"]=this.getFontStyleFromVariant(b)}else-1!==a.attr("name").indexOf("[")?(f=a.attr("name").split("["),f[0]=f[0].replace("]",""),f[1]=f[1].replace("]",""),d[f[0]]=d[f[0]]||{},d[f[0]][f[1]]=b):d[c][a.attr("name")]=b;else a.hasClass("fusion-image-as-object")?(b=jQuery.parseJSON(b),d[c]=b):d[c]=b;void 0!==FusionApp.contentChange&&("TO"===e||"FBE"===e?(FusionEvents.trigger("fusion-to-changed"),FusionEvents.trigger("fusion-to-"+c+"-changed"),FusionApp.contentChange("global","theme-option"),window.dispatchEvent(new Event("fusion-to-"+c+"-changed"))):"PO"===e||"TAXO"===e?(FusionEvents.trigger("fusion-po-changed"),FusionEvents.trigger("fusion-po-"+c+"-changed"),FusionApp.contentChange("page","page-option"),window.dispatchEvent(new Event("fusion-po-"+c+"-changed"))):"PS"===e&&(FusionEvents.trigger("fusion-ps-changed"),FusionEvents.trigger("fusion-"+c+"-changed"),FusionApp.contentChange("page","page-setting"),window.dispatchEvent(new Event("fusion-page-"+c+"-changed"))))},getSaveId:function(a,b,c){var d=this.model.get("fields");if("PO"===c){if(a.hasClass("fusion-po-dimension"))return a.attr("id");if(!_.isUndefined(d[b])&&_.isUndefined(d[b].not_pyre)&&FusionApp.data.singular)return b}return b},getSaveLocation:function(a,b){switch(a){case"FBE":case"TO":return FusionApp.settings;case"PS":return FusionApp.data.postDetails;case"PO":case"TAXO":return"_wp_page_template"===b||"_thumbnail_id"===b||"_fusion_builder_custom_css"===b?FusionApp.data.postMeta:(FusionApp.data.postMeta._fusion=FusionApp.data.postMeta._fusion||{},FusionApp.data.postMeta._fusion)}},updatePreview:function(a,b,c){var d=this,e=jQuery(a.currentTarget),f=e.parents(".fusion-builder-option"),g=f.data("option-id"),h=e.val(),i=f.data("type"),j=this.getSaveLocation(i,g),k=f.find(".option-preview-toggle").length,l=!1,m=this.getSaveId(e,g,i),n=this.model.get("fields");if(h=this.getValue(e,a,h),(!0===b||this.needsUpdate(e,h,m,j))&&(this.saveChange(e,h,m,j,i),"TO"!==i&&"FBE"!==i||(FusionApp.createMapObjects(),"object"==typeof j[m]?(this.updateSettingsToParams(g+"["+e.attr("name")+"]",h),this.updateSettingsToExtras(g+"["+e.attr("name")+"]",h),this.updateSettingsToParams(g,j[m]),this.updateSettingsToExtras(g,j[m]),this.updateSettingsToPo(g,j[m])):(this.updateSettingsToParams(g,h),this.updateSettingsToExtras(g,h),this.updateSettingsToPo(g,h)),FusionEvents.trigger("fusion-preview-update",g,h)),!1!==this.checkUpdateCallbacks(n[g])&&("post_title"===g&&this.maybeUpdateSlug(h),(void 0===jQuery(a.currentTarget).attr("class")||"fusion-multiselect-input"!==jQuery(a.currentTarget).attr("class"))&&n[g]&&(!n[g].id||"color_palette"!==n[g].id)))){if(n[g].id&&"custom_css"===n[g].id)return void avadaPanelIFrame.liveUpdateCustomCSS(h);if(n[g].id&&"_fusion_builder_custom_css"===n[g].id)return void avadaPanelIFrame.liveUpdatePageCustomCSS(h);(n[g].output||n[g].css_vars)&&!1!==avadaPanelIFrame.applyRefreshCallbacks(n[g].css_vars,h)&&(k&&this.triggerTemporaryState(f),avadaPanelIFrame.generateCSS(m,n[g].output,n[g].css_vars,i,k,n[g].type),_.isUndefined(n[g].output_fields_trigger_change)||(c||(c=[g]),_.each(n[g].output_fields_trigger_change,function(a){-1===c.indexOf(a)&&(c.push(a),d.updatePreview({currentTarget:jQuery('.fusion-builder-option[data-option-id="'+a+'"] input')},!0,c))})),avadaPanelIFrame.populateFieldOutputDependencies(),avadaPanelIFrame.fieldOutputDependencies[g]&&(c||(c=[g]),_.each(avadaPanelIFrame.fieldOutputDependencies[g],function(a){-1===c.indexOf(a)&&(c.push(a),d.updatePreview({currentTarget:jQuery('.fusion-builder-option[data-option-id="'+a+'"] input')},!0,c))})),l=!0),_.isUndefined(n[g].partial_refresh)||_.isEmpty(n[g].partial_refresh)||!1!==avadaPanelIFrame.applyRefreshCallbacks(n[g].partial_refresh,h)&&(avadaPanelIFrame.partialRefresh(m,n[g].partial_refresh,h,this.model.get("cid")),l=!0),_.isUndefined(n[g].transport)||"postMessage"!==n[g].transport||(l=!0,FusionEvents.trigger("fusion-postMessage-"+g),window.dispatchEvent(new Event("fusion-postMessage-"+g))),l&&(_.isUndefined(n[g].transport)||"refresh"!==n[g].transport)||!1!==avadaPanelIFrame.applyRefreshCallbacks(n[g].full_refresh,h)&&(f.addClass("full-refresh-active"),FusionApp.fullRefresh(),FusionEvents.once("fusion-app-setup",function(){f.removeClass("full-refresh-active")}))}},maybeUpdateSlug:function(a){var b,c,d,e,f=this.$el.find("#post_name");if(f.length&&(f.val()&&""!==f.val()||(this.hasSlug=!1),a&&""!==a&&!this.hasSlug)){for(a=a.replace(/^\s+|\s+$/g,"").toLowerCase(),b="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",c="aaaaeeeeiiiioooouuuunc------",d=0,e=b.length;d<e;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));a=a.replace(".","-").replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),f.val(a).trigger("change")}},cloneValue:function(a){return a},updateSettingsToParams:function(a,b,c){var d,e,f,g=this,h=g.cloneValue(b);c=void 0!==c&&c,_.isUndefined(FusionApp.settingsToParams[a])||_.each(FusionApp.settingsToParams[a],function(i){_.isUndefined(fusionAllElements[i.element])||(i.callback&&(b=avadaPanelIFrame.applyCallback(h,i.callback,!1)),fusionAllElements[i.element].defaults[i.param]=b,_.isUndefined(fusionAllElements[i.element].params[i.param])||_.isUndefined(fusionAllElements[i.element].params[i.param].default)||("colorpickeralpha"!==fusionAllElements[i.element].params[i.param].type&&"color"!==fusionAllElements[i.element].params[i.param].type&&"range"!==fusionAllElements[i.element].params[i.param].type||(fusionAllElements[i.element].params[i.param].default=b),"colorpickeralpha"!==fusionAllElements[i.element].params[i.param].type&&"color"!==fusionAllElements[i.element].params[i.param].type||(d=jQuery("."+i.element+' [data-option-id="'+i.param+'"] .fusion-builder-color-picker-hex'),1===d.length&&(d.data("default",b).trigger("change"),""===d.val()&&(d.addClass("fusion-default-changed"),d.hasClass("wp-color-picker")&&d.wpColorPicker("color",b)))),jQuery('.description [data-fusion-option="'+a+'"]').length&&(f=jQuery('.description [data-fusion-option="'+a+'"]').closest(".fusion-builder-option").attr("class").split(" ").pop(),e=FusionApp.sidebarView.fixToValueName(a,b,f),jQuery('.description [data-fusion-option="'+a+'"]').html(e))),FusionEvents.trigger("fusion-param-default-update-"+i.param,b),c||(FusionEvents.trigger("fusion-global-update-"+i.element,i.param,b),g.triggerActiveStates()))})},updateSettingsToExtras:function(a,b,c){var d=this,e=d.cloneValue(b);"object"!=typeof FusionApp.settingsToExtras||_.isUndefined(FusionApp.settingsToExtras[a])||(c=void 0!==c&&c,_.each(FusionApp.settingsToExtras[a],function(a){_.isUndefined(fusionAllElements[a.element])||(a.callback&&(b=avadaPanelIFrame.applyCallback(e,a.callback,!1)),fusionAllElements[a.element].extras[a.param]=b,c||(FusionEvents.trigger("fusion-extra-update-"+a.element,a.param,b),d.triggerActiveStates()))}))},updateSettingsToPo:function(a,b){var c,d=this.cloneValue(b);_.isUndefined(FusionApp.settingsToPo[a])||_.isUndefined(FusionApp.data.fusionPageOptions)||_.isEmpty(FusionApp.data.fusionPageOptions)||_.each(FusionApp.settingsToPo[a],function(a){_.isUndefined(FusionApp.data.fusionPageOptions[a.tab])||_.isUndefined(FusionApp.data.fusionPageOptions[a.tab].fields[a.option])||(c=FusionApp.data.fusionPageOptions[a.tab].fields[a.option],a.callback&&(b=avadaPanelIFrame.applyCallback(d,a.callback,!1)),FusionApp.sidebarView.clearTabs("po",!1,a.option),"color-alpha"!==c.type&&"color"!==c.type&&"slider"!==c.type&&"sortable"!==c.type||(c.default=b))})},validateOption:function(a){var b=jQuery(a.currentTarget),c=b.val(),d=b.parents(".fusion-builder-option"),e=d.data("option-id"),f=!0,g="";return"checkbox"===b.attr("type")&&(c=b.is(":checked")?"1":"0"),d.hasClass("spacing")||d.hasClass("dimension")?(f=FusionApp.validate.cssValue(c),g=fusionBuilderTabL10n.invalidCssValue):d.hasClass("color")?(f=FusionApp.validate.validateColor(c,"hex"),g=fusionBuilderTabL10n.invalidColor):d.hasClass("color-alpha")?(f=FusionApp.validate.validateColor(c),g=fusionBuilderTabL10n.invalidColor):d.hasClass("typography")&&("font-size"===b.attr("name")?(f=FusionApp.validate.cssValue(c),g=fusionBuilderTabL10n.invalidCssValueVar.replace("%s",b.attr("name"))):"line-height"!==b.attr("name")&&"letter-spacing"!==b.attr("name")||(f=FusionApp.validate.cssValue(c,!0),g=fusionBuilderTabL10n.invalidCssValueVar.replace("%s",b.attr("name")))),!1===f?(FusionApp.validate.message("add",e,b,g),!1):(FusionApp.validate.message("remove",e,b),!0)},checkUpdateCallbacks:function(a){var b=!0,c=[],d=!1;return a&&a.id&&a.update_callback&&_.each(a.update_callback,function(a){var b;if(a.operator)switch(b=a.where?FusionApp.data[a.where]:FusionApp.data,a.operator){case"===":b[a.condition]!==a.value&&c.push(!1);break;case"!==":b[a.condition]===a.value&&c.push(!1)}else _.each(a,function(a){if(a.operator)switch(b=a.where?FusionApp.data[a.where]:FusionApp.data,a.operator){case"===":b[a.condition]===a.value&&(d=!0);break;case"!==":b[a.condition]!==a.value&&(d=!0)}}),c.push(d)}),_.each(c,function(a){a||(b=!1)}),b}}),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionTypographyField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionCodeBlock),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionColorPicker),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionDimensionField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionOptionUpload),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.radioButtonSet),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRangeField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRepeaterField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSelectField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionAjaxSelect),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionMultiSelect),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSwitchField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionImportUpload),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionExport),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSortable),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionColorPalette),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRawField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionLinkSelector),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.fusionActiveStates)}(jQuery);var FusionPageBuilder=FusionPageBuilder||{};!function(){_.extend(FusionPageBuilder.Callback.prototype,{fusion_get_alpha:function(a){return jQuery.Color(a).alpha()},createSocialNetworks:function(){var a=[];return"0"!=FusionApp.settings.sharing_facebook&&a.push("facebook"),"0"!=FusionApp.settings.sharing_twitter&&a.push("twitter"),"0"!=FusionApp.settings.sharing_linkedin&&a.push("linkedin"),"0"!=FusionApp.settings.sharing_reddit&&a.push("reddit"),"0"!=FusionApp.settings.sharing_whatsapp&&a.push("whatsapp"),"0"!=FusionApp.settings.sharing_tumblr&&a.push("tumblr"),"0"!=FusionApp.settings.sharing_pinterest&&a.push("pinterest"),"0"!=FusionApp.settings.sharing_vk&&a.push("vk"),"0"!=FusionApp.settings.sharing_email&&a.push("mail"),a.join("|")},toYes:function(a){return 1==a||!0===a?"yes":"no"},toLowerCase:function(a){return a.toLowerCase()},urlFromObject:function(a){return"object"==typeof a&&void 0!==a.url?a.url:""},portfolioPaginationFormat:function(a){return a.toLowerCase().replace(/ /g,"").replace(/\_/g,"-").replace("scroll","").replace(/-\s*$/,"")},noPortfolioOnPage:function(){return!(0<jQuery("#fb-preview").contents().find(".fusion-portfolio-layout-grid, .fusion-portfolio-carousel").length)},isPaginationOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".pagination").length},isRolloverOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".fusion-image-wrapper").length},isMasonryOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".fusion-blog-layout-masonry, .fusion-portfolio-masonry, .fusion-gallery-layout-masonry").length},updateGridSeps:function(a){var b="",c=jQuery("#fb-preview").contents().find("div.fusion-content-sep");return _.each(a.split("|"),function(a){b+=" sep-"+a}),c.removeClass("sep-single sep-solid sep-double sep-dashed sep-dotted sep-shadow"),c.addClass(b),!0},timeLineColorCallback:function(){return!(0<jQuery("#fb-preview").contents().find(".fusion-blog-layout-masonry, .twitter-timeline-rendered").length)},fusionEditGlobalSidebar:function(a){var b="pages_sidebar";FusionApp.data.is_singular_post?b="posts_sidebar":FusionApp.data.is_portfolio_single?b="portfolio_sidebar":FusionApp.data.is_portfolio_archive?b="portfolio_archive_sidebar":FusionApp.data.is_search?b="search_sidebar":FusionApp.data.is_product?b="woo_sidebar":FusionApp.data.is_woo_archive?b="woocommerce_archive_sidebar":FusionApp.data.is_singular_ec?b="ec_sidebar":FusionApp.data.is_bbpress||FusionApp.data.is_buddypress?b="ppbress_sidebar":(FusionApp.data.is_home||FusionApp.data.is_archive&&!FusionApp.data.is_search)&&(b="blog_archive_sidebar"),-1<a.data("fusion-option").indexOf("_2")&&(b+="_2"),FusionApp.sidebarView.openOption(b,"to",a.data("fusion-option-open-parent"))},fusionEditFeaturedImage:function(a){FusionApp.sidebarView.openOption("_thumbnail_id","po",a.data("fusion-option-open-parent"))}})}(jQuery);