!function(e){"use strict";fusionredux.field_objects=fusionredux.field_objects||{},fusionredux.field_objects.background=fusionredux.field_objects.background||{},fusionredux.field_objects.background.init=function(i){i||(i=e(document).find(".fusionredux-group-tab:visible").find(".fusionredux-container-background:visible")),e(i).each(function(){var i=e(this),n=i;if(i.hasClass("fusionredux-field-container")||(n=i.parents(".fusionredux-field-container:first")),!n.is(":hidden")&&n.hasClass("fusionredux-field-init")){n.removeClass("fusionredux-field-init"),i.find(".fusionredux-remove-background").unbind("click").on("click",function(i){return i.preventDefault(),fusionredux.field_objects.background.removeImage(e(this).parents(".fusionredux-container-background:first")),!1}),i.find(".fusionredux-background-upload").unbind().on("click",function(i){fusionredux.field_objects.background.addImage(i,e(this).parents(".fusionredux-container-background:first"))}),i.find(".fusionredux-background-input").on("change",function(){fusionredux.field_objects.background.preview(e(this))}),i.find(".fusionredux-color").wpColorPicker({change:function(i,n){e(this).val(n.color.toString()),fusionredux_change(e(this)),e("#"+i.target.id+"-transparency").removeAttr("checked"),fusionredux.field_objects.background.preview(e(this))},clear:function(i,n){e(this).val(n.color.toString()),fusionredux_change(e(this).parent().find(".fusionredux-color-init")),fusionredux.field_objects.background.preview(e(this))},palettes:["#000000","#ffffff","#f44336","#E91E63","#03A9F4","#00BCD4","#8BC34A","#FFEB3B","#FFC107","#FF9800","#607D8B"]}),i.find(".fusionredux-color").on("blur",function(){var n=e(this).val(),r="#"+e(this).attr("id");"transparent"===n?(e(this).parent().parent().find(".wp-color-result").css("background-color","transparent"),i.find(r+"-transparency").attr("checked","checked")):(colorValidate(this)===n&&0!==n.indexOf("#")&&e(this).val(e(this).data("oldcolor")),i.find(r+"-transparency").removeAttr("checked"))}),i.find(".fusionredux-color").on("focus",function(){e(this).data("oldcolor",e(this).val())}),i.find(".fusionredux-color").on("keyup",function(){var n=e(this).val(),r=colorValidate(this),a="#"+e(this).attr("id");"transparent"===n?(e(this).parent().parent().find(".wp-color-result").css("background-color","transparent"),i.find(a+"-transparency").attr("checked","checked")):(i.find(a+"-transparency").removeAttr("checked"),r&&r!==e(this).val()&&e(this).val(r))}),i.find(".color-transparency").on("click",function(){if(e(this).is(":checked"))i.find(".fusionredux-saved-color").val(e("#"+e(this).data("id")).val()),i.find("#"+e(this).data("id")).val("transparent"),i.find("#"+e(this).data("id")).parent().parent().find(".wp-color-result").css("background-color","transparent");else if("transparent"===i.find("#"+e(this).data("id")).val()){var n=e(".fusionredux-saved-color").val();""===n&&(n=e("#"+e(this).data("id")).data("default-color")),i.find("#"+e(this).data("id")).parent().parent().find(".wp-color-result").css("background-color",n),i.find("#"+e(this).data("id")).val(n)}fusionredux.field_objects.background.preview(e(this)),fusionredux_change(e(this))});var r={width:"resolve",triggerChange:!0,allowClear:!0},a=i.find(".select3_params");if(a.size()>0){var t=a.val();t=JSON.parse(t),r=e.extend({},r,t)}i.find(" .fusionredux-background-repeat, .fusionredux-background-clip, .fusionredux-background-origin, .fusionredux-background-size, .fusionredux-background-attachment, .fusionredux-background-position").select3(r)}})},fusionredux.field_objects.background.preview=function(i){var n=e(i).parents(".fusionredux-container-background:first"),r=e(n).find(".background-preview");if(r){var a=!0,t="height:"+r.height()+"px;";e(n).find(".fusionredux-background-input").each(function(){var i=e(this).serializeArray();(i=i[0])&&-1!=i.name.indexOf("[background-")&&""!==i.value&&(a=!1,i.name=i.name.split("[background-"),i.name="background-"+i.name[1].replace("]",""),"background-image"==i.name?t+=i.name+':url("'+i.value+'");':t+=i.name+":"+i.value+";")}),a?r.slideUp():r.attr("style",t).fadeIn()}},fusionredux.field_objects.background.addImage=function(i,n){var r;i.preventDefault();var a=e(this);r?r.open():((r=wp.media({multiple:!1,library:{},title:a.data("choose"),button:{text:a.data("update")}})).on("select",function(){var i=r.state().get("selection").first();if(r.close(),"image"===i.attributes.type){n.find(".upload").val(i.attributes.url),n.find(".upload-id").val(i.attributes.id),n.find(".upload-height").val(i.attributes.height),n.find(".upload-width").val(i.attributes.width),fusionredux_change(e(n).find(".upload-id"));var a=i.attributes.url;if(void 0!==i.attributes.sizes&&void 0!==i.attributes.sizes.thumbnail)a=i.attributes.sizes.thumbnail.url;else if(void 0!==i.attributes.sizes){var t=i.attributes.height;for(var d in i.attributes.sizes){var o=i.attributes.sizes[d];o.height<t&&(t=o.height,a=o.url)}}else a=i.attributes.icon;n.find(".upload-thumbnail").val(a),n.find(".upload").hasClass("noPreview")||n.find(".screenshot").empty().hide().append('<img class="fusionredux-option-image" src="'+a+'">').slideDown("fast"),n.find(".fusionredux-remove-background").removeClass("hide"),n.find(".fusionredux-background-input-properties").slideDown(),fusionredux.field_objects.background.preview(n.find(".upload"))}}),r.open())},fusionredux.field_objects.background.removeImage=function(i){i.find(".fusionredux-remove-background").addClass("hide")&&(i.find(".fusionredux-remove-background").addClass("hide"),i.find(".upload").val(""),i.find(".upload-id").val(""),i.find(".upload-height").val(""),i.find(".upload-width").val(""),fusionredux_change(e(i).find(".upload-id")),i.find(".fusionredux-background-input-properties").hide(),i.find(".screenshot").slideUp(),i.find(".remove-file").unbind(),e(".section-upload .upload-notice").length>0&&e(".fusionredux-background-upload").remove())}}(jQuery);