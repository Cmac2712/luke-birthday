!function($){"use strict";fusionredux.field_objects=fusionredux.field_objects||{},fusionredux.field_objects.repeater=fusionredux.field_objects.repeater||{},$(document).ready(function(){}),fusionredux.field_objects.repeater.sort_repeaters=function(e){e.hasClass("fusionredux-container-repeater")||(e=e.parents(".fusionredux-container-repeater:first")),e.find(".fusionredux-repeater-accordion-repeater").each(function(e){var r=$(this).attr("data-sortid"),t=$(this).find("input[name*='["+r+"]']");t.each(function(){$(this).attr("name",$(this).attr("name").replace("["+r+"]","["+e+"]"))});var a=$(this).find("select[name*='["+r+"]']");a.each(function(){$(this).attr("name",$(this).attr("name").replace("["+r+"]","["+e+"]"))}),$(this).attr("data-sortid",e);var i=$(this).find(".ui-accordion-header"),d=i.attr("id").split("-header-");i.attr("id",d[0]+"-header-"+e),d=i.attr("aria-controls").split("-panel-"),i.attr("aria-controls",d[0]+"-panel-"+e);var n=$(this).find(".ui-accordion-content"),d=n.attr("id").split("-panel-");n.attr("id",d[0]+"-panel-"+e),d=n.attr("aria-labelledby").split("-header-"),n.attr("aria-labelledby",d[0]+"-header-"+e)})},fusionredux.field_objects.repeater.init=function(e){e||(e=$(document).find(".fusionredux-group-tab:visible").find(".fusionredux-container-repeater:visible")),$(e).each(function(e){var r=$(this),t=r;if(r.hasClass("fusionredux-field-container")||(t=r.parents(".fusionredux-field-container:first")),!t.is(":hidden")&&t.hasClass("fusionredux-field-init")){t.removeClass("fusionredux-field-init");var t=r;r.hasClass("fusionredux-field-container")||(t=r.parents(".fusionredux-field-container:first"));var a=t.attr("data-id"),i=r.find(".fusionredux-repeater-accordion-repeater:last-child");if(fusionredux.repeater[a].blank=i.clone().wrap("<p>").parent().html(),t.hasClass("fusionredux-container-repeater")&&t.addClass("fusionredux-field-init"),t.hasClass("fusionredux-field-init")){t.removeClass("fusionredux-field-init");var d=!1,n=r.find(".fusionredux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:!0,activate:function(e,r){$.fusionredux.initFields()},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}});1==fusionredux.repeater[a].sortable?n.sortable({axis:"y",handle:"h3",connectWith:".fusionredux-repeater-accordion",placeholder:"ui-state-highlight",start:function(e,r){r.placeholder.height(r.item.height()),r.placeholder.width(r.item.width())},stop:function(e,r){r.item.children("h3").triggerHandler("focusout"),fusionredux.field_objects.repeater.sort_repeaters($(this))}}):n.find("h3.ui-accordion-header").css("cursor","pointer"),r.find(".fusionredux-repeater-accordion-repeater .bind_title").on("change keyup",function(e){if($(e.target).find(":selected").text().length>0)var r=$(e.target).find(":selected").text();else var r=$(e.target).val();$(this).closest(".fusionredux-repeater-accordion-repeater").find(".fusionredux-repeater-header").text(r)}),r.on("click",".fusionredux-repeaters-remove",function(){fusionredux_change($(this));var e=$(this).parents(".fusionredux-container-repeater:first"),t=e.attr("data-id");fusionredux.repeater[t].blank=$(this).parents(".fusionredux-repeater-accordion-repeater:first").clone(!0,!0),$(this).parents(".fusionredux-repeater-accordion-repeater:first").slideUp("medium",function(){if($(this).remove(),fusionredux.field_objects.repeater.sort_repeaters(r),""!=fusionredux.repeater[t].limit){var a=e.find(".fusionredux-repeater-accordion-repeater").length;a<fusionredux.repeater[t].limit&&e.find(".fusionredux-repeaters-add").removeClass("button-disabled")}e.find(".fusionredux-repeater-accordion-repeater:last .ui-accordion-header").click()})}),String.prototype.fusionreduxReplaceAll=function(e,r){return this.replace(new RegExp(e.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),r)},r.find(".fusionredux-repeaters-add").click(function(){if(!$(this).hasClass("button-disabled")){var e=$(this).parent().find(".fusionredux-repeater-accordion:first"),t=e.find(".fusionredux-repeater-accordion-repeater").length,a=e.attr("data-id");if(""!=fusionredux.repeater[a].limit&&t>=fusionredux.repeater[a].limit)return void $(this).addClass("button-disabled");t++;var i=e.find(".fusionredux-repeater-accordion-repeater").size();e.find(".fusionredux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")&&e.find(".fusionredux-repeater-accordion-repeater:last").find(".ui-accordion-header").click();var d=e.find(".fusionredux-repeater-accordion-repeater:last").clone(!0,!0);if(0==d.length&&(d=fusionredux.repeater[a].blank),fusionredux.repeater[a]){fusionredux.repeater[a].count=r.find(".fusionredux-repeater-header").length;var n=fusionredux.repeater[a].html.fusionreduxReplaceAll("99999",i);$(d).find(".fusionredux-repeater-header").text("")}d.find(".ui-accordion-content").html(n),$(e).append(d),fusionredux.field_objects.repeater.sort_repeaters(d);var d=$(this).parent().find(".fusionredux-repeater-accordion:first");d.find(".fusionredux-repeater-accordion-repeater:last .ui-accordion-header").click(),d.find(".fusionredux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(e){if($(e.target).find(":selected").text().length>0)var r=$(e.target).find(":selected").text();else var r=$(e.target).val();$(this).closest(".fusionredux-repeater-accordion-repeater").find(".fusionredux-repeater-header").text(r)}),fusionredux.repeater[a].limit>0&&t>=fusionredux.repeater[a].limit&&$(this).addClass("button-disabled")}})}}})}}(jQuery);
